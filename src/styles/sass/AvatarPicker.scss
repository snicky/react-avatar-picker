@import url('https://fonts.googleapis.com/css?family=Source+Sans+Pro');

@mixin opacity-transition($opacity, $time) {
  opacity: $opacity;
  -webkit-transition: opacity $time ease-in-out;
     -moz-transition: opacity $time ease-in-out;
      -ms-transition: opacity $time ease-in-out;
       -o-transition: opacity $time ease-in-out;
}

@mixin spin($fullCircleSpinTime) {
  -webkit-animation-name:            spin;
  -webkit-animation-duration:        $fullCircleSpinTime;
  -webkit-animation-iteration-count: infinite;
  -webkit-animation-timing-function: linear;

  @keyframes spin {
     from {
         transform: rotate(0deg);
     } to {
         transform: rotate(360deg);
     }
  }
}

.avatar-picker {
  $image-diameter:                60px;
  $current-avatar-border-size:    1px;
  $popover-width:                 280px;
  $popover-background-color:      rgb(44, 48, 51);
  $popover-triangle-edge-length:  8px;
  $popover-padding:               14px;
  $popover-image-margin:          $popover-padding / 2;
  $popover-image-border-size:     3px;
  $popover-image-border:          $popover-image-border-size solid $popover-background-color;
  $popover-image-hover-border:    $popover-image-border-size solid rgb(155, 160, 163);
  $spinner-color:                 rgb(122, 161, 178);
  $popover-images-per-row:        4;
  $popover-total-margins-per-row: ($popover-images-per-row+1)*2*$popover-image-margin;
  $popover-image-diameter:        floor(($popover-width - $popover-total-margins-per-row)/$popover-images-per-row);

  margin:   auto;
  position: relative;
  width:    $image-diameter;

  @mixin img-circle {
    border-radius: 50%;
  }

  img {
    @include img-circle;
    width:  $image-diameter;
    height: $image-diameter;
    cursor: pointer;

    &.current {
      border: $current-avatar-border-size solid white;

      &:hover, &:focus {
        border: $current-avatar-border-size solid rgb(155, 160, 163);
      }
    }
  }

  .popover {
    @include opacity-transition(0, 0.3s);
  	position:      absolute;
    width:         $popover-width;
    top:           10;
    left:          -($popover-width - $image-diameter)/2;
    padding:       $popover-padding $popover-image-margin $popover-padding - $popover-image-margin;
    background:    $popover-background-color;
    border-radius: 2px;
    box-shadow:    0 0 10px 2px rgb(102, 102, 102);
    box-sizing:    border-box;
    text-align:    left;

    &.opened {
      @include opacity-transition(1, 0s);
    }

    // Triangle
    &:after {
      bottom:              100%;
      left:                50%;
      border:              solid transparent;
      content:             " ";
      height:              0;
      width:               0;
      position:            absolute;
      pointer-events:      none;
      border-color:        transparent;
      border-bottom-color: $popover-background-color;
      border-width:        $popover-triangle-edge-length;
      margin-left:         -$popover-triangle-edge-length;
    }

    .title {
      font-family:   'Source Sans Pro', sans-serif;
      color:         rgb(249, 249, 249);
      font-size:     16px;
      margin-bottom: $popover-padding;
      text-align:    center;
    }

    ul {
      list-style: none outside none;
      margin:     0;
      padding:    0;
    }

    .image-wrapper {
      display:       inline-block;
      position:      relative;
      width:         $popover-image-diameter;
      height:        $popover-image-diameter;
      margin:        $popover-image-margin - $popover-image-border-size;
      border:        $popover-image-border;
      border-radius: 50%;

      &:not(.loading).hovered {
        border: $popover-image-hover-border;

        .image-overlay {
          background-color: rgba(122, 161, 178, 0.2);
        }
      }

      &.spinning {
        .image-overlay { display: none; }
        .image-spinner { display: block; }
      }

      img {
        width:  100%;
        height: 100%;
        border: 0;
      }

      .image-overlay {
        position:      absolute;
        top:           0;
        left:          0;
        width:         $popover-image-diameter;
        height:        $popover-image-diameter;
        border-radius: 50%;
        cursor:        pointer;
      }

      .image-spinner {
        @include spin(1s);
        position:      absolute;
        display:       none;
        top:           -$popover-image-border-size;
        left:          -$popover-image-border-size;
        width:         $popover-image-diameter;
        height:        $popover-image-diameter;
        border-radius: 50%;
        border:        $popover-image-border-size solid;
        border-color:  transparent $spinner-color $spinner-color $spinner-color;
        transform:     rotate(0deg);
      }
    }
  }
}
